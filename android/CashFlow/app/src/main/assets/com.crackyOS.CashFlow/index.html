<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./src/mdl/googleAPI-style.css" />
    <link rel="stylesheet" href="./src/mdl/mdl-style.css" />
    <link rel="stylesheet" href="./src/css/style.css" />
    <script src="./src/mdl/mdl-script.js"></script>
    <script src="./src/js/sections.js"></script>
    <script src="./src/js/chart.js"></script>
  </head>

  <style>
    .section {
      display: none !important;
    }

    .active {
      display: block !important;
    }

    .chart-container {
      width: 310px;
      height: 180px;
    }
    canvas {
      width: 310px !important;
      height: 180px !important;
    }
  </style>

  <body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
          <span class="mdl-layout-title" id="masterTitle">CashFlow</span>
          <div class="mdl-layout-spacer"></div>
          <nav class="mdl-navigation">
            <!--icons-->
            <a
              class="mdl-navigation__link"
              id="home"
              style="cursor: pointer"
              onclick="show_section('mainSection');"
              ><i class="material-icons">home</i></a
            >
            <a
              class="mdl-navigation__link"
              id="debug"
              style="cursor: pointer"
              onclick="show_section('debugSection');"
              ><i class="material-icons">android</i></a
            >
          </nav>
        </div>
      </header>
      <div class="mdl-layout__drawer">
        <span class="mdl-layout-title" id="menuTitle">Menü</span>
        <nav class="mdl-navigation">
          <!--<a class="mdl-navigation__link" href="">Link</a>
          <a class="mdl-navigation__link" href="">Link</a>-->
        </nav>
      </div>
      <main class="mdl-layout__content">
        <div class="page-content">
          <center>
            <div id="mainSection" class="section active">
              <br><br>
              <div id="diagramm" class="diagramm" onclick="show_section('historySection');">
                <div style="width: 340px; height: 200px;">
                  <canvas id="balanceChart" style="width: 100%; height: 100%;"></canvas>
                </div>
                <script src="./src/js/diagram.js"></script>
              </div>
              <br />
              <button
                onclick="show_section('increaseSection');"
                class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
                mehrung</button>&nbsp;
              <button
                onclick="show_section('decreaseSection');"
                class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
                minderung
              </button>
            </div>




            <div id="historySection" class="section">
              <div class="container">
                  <div class="entry-title">
                    <div id="balanceDisplay" class="balance-display"></div>
                    <hr>
                      <h4>Alle Transaktionen</h4>
                  </div>
                  <div id="entries"></div>
              </div>
          </div>
          
          <script>
            function displayEntries() {
              const entriesContainer = document.getElementById("entries");
              const balanceHistory = JSON.parse(localStorage.getItem("balanceHistory")) || [];

              if (balanceHistory.length === 0) {
                  entriesContainer.innerHTML = "<p>Keine Transaktionen gefunden.</p>";
                  return;
              }
              balanceHistory.sort((a, b) => new Date(b.date) - new Date(a.date));

              entriesContainer.innerHTML = balanceHistory.map(entry => `
                  <div class="entry">
                      <div class="entry-content">
                          <div class="entry-header">
                              <h5 class="entry-title">${entry.date}</h5>
                              <div class="entry-value ${parseFloat(entry.value) < 0 ? 'negative' : 'positive'}">
                                  ${entry.value}€
                              </div>
                          </div>
                          <div class="entry-reason">${entry.reason ? entry.reason : ''}</div>
                      </div>
                  </div>`).join("");
              }
            displayEntries();

            function calculateBalance() {
                const balanceHistory = JSON.parse(localStorage.getItem("balanceHistory")) || [];
                const totalBalance = balanceHistory.reduce((total, entry) => {
                    return total + parseFloat(entry.value);
                }, 0);

                return totalBalance;
            }

            function displayBalance() {
                const balance = calculateBalance();
                const balanceContainer = document.getElementById("balanceDisplay");
                balanceContainer.innerHTML = `Kontostand: <strong>${balance.toFixed(2)}€</strong>`;
            }
            displayBalance();

          </script>
          





            <div id="increaseSection" class="section">
              <br><br>
              <div class="form-container">
                <h5>Neue Transaktion hinzufügen</h5>
                <form id="increaseForm">
                  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="reason_i">
                    <label class="mdl-textfield__label" for="reason_i">Grund Einnahme</label>
                  </div>
                  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" pattern="-?[0-9]*(\.[0-9]+)?" id="value_i">
                    <label class="mdl-textfield__label" for="value_i">Wert der Einnahme</label>
                    <span class="mdl-textfield__error">Input is not a number!</span>
                  </div><br><br>
                  <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" type="submit">Hinzufügen</button>
                </form>
              </div>
              <script src="./src/js/increase.js"></script>
            </div>




            <div id="decreaseSection" class="section">
              <br><br>
              <div class="form-container">
                <h5>Neue Transaktion hinzufügen</h5>
                <form id="decreaseForm">
                  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="reason_d">
                    <label class="mdl-textfield__label" for="reason_d">Grund Ausgabe</label>
                  </div>
                  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" pattern="-?[0-9]*(\.[0-9]+)?" id="value_d">
                    <label class="mdl-textfield__label" for="value_d">Wert der Ausgabe</label>
                    <span class="mdl-textfield__error">Input is not a number!</span>
                  </div><br><br>
                  <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" type="submit">Hinzufügen</button>
                </form>
              </div>
              <script src="./src/js/decrease.js"></script>
            </div>




            <div id="pinSection" class="section">
              <h4>pinSection</h4>
            </div>




            <div id="debugSection" class="section">
              <h4>debugSection</h4>
              <button onclick="setTestData();">localStorage.testData()</button>
              <br><br>
              <button onclick="localStorage.clear();">localStorage.clear()</button>
              <br><br>
              <button onclick="location.reload();">location.reload()</button>

              <script>
                function setTestData() {
                  const exampleData = [
                    { date: "2024-08-01", reason: "Gehalt", value: "+100" },
                    { date: "2024-08-02", reason: "Einkauf", value: "-50" },
                    { date: "2024-08-03", reason: "Bonus", value: "+75" },
                    { date: "2024-08-04", reason: "Rechnung", value: "-30" },
                    { date: "2024-08-05", reason: "Verkauf", value: "+150" },
                    { date: "2024-08-06", reason: "Miete", value: "-90" },
                  ];
                  localStorage.setItem(
                    "balanceHistory",
                    JSON.stringify(exampleData)
                  );
                }
              </script>
            </div>
          </center>
        </div>
      </main>
    </div>
  </body>
</html>
